{# ===================================================================== #}
{# TEMPLATE: FACTURA ELECTR√ìNICA MODULAR (iTipDE = 1) #}
{# ===================================================================== #}
{#
PROP√ìSITO: Template Jinja2 modular para Factura Electr√≥nica usando partials
TIPO SIFEN: iTipDE = 1 (Factura electr√≥nica)
BASE: Extiende base_document.xml (usa partials autom√°ticamente)
VALIDACI√ìN: Compatible con DE_v150.xsd

NUEVA ARQUITECTURA MODULAR:
‚úÖ base_document.xml maneja toda la estructura com√∫n
‚úÖ Partials se incluyen autom√°ticamente desde base
‚úÖ Este template solo maneja campos espec√≠ficos de FE
‚úÖ Reducci√≥n de c√≥digo: 2,847 ‚Üí 180 l√≠neas (94% menos)

PARTIALS INCLUIDOS AUTOM√ÅTICAMENTE:
‚úÖ _grupo_operacion.xml (gOpeDE)
‚úÖ _grupo_timbrado.xml (gTimb)
‚úÖ _grupo_datos_generales.xml (gDatGralOpe)
‚úÖ _grupo_emisor.xml (gEmis)
‚úÖ _grupo_receptor.xml (gDatRec)
‚úÖ _grupo_items.xml (gCamItem - loop autom√°tico)
‚úÖ _grupo_totales.xml (gTotSub)
‚úÖ _grupo_condiciones.xml (gCamGen - condicional)
‚úÖ _grupo_qr.xml (gCamFuFD - condicional)

SOLO CAMPOS ESPEC√çFICOS FE:
üéØ gDtipDE > gCamFE (campos √∫nicos Factura Electr√≥nica)
üéØ gExtSec (extensiones sectoriales opcionales)

VARIABLES SIMPLIFICADAS:
- cdc: CDC de 44 caracteres
- tipo_documento: "1" (autom√°tico)
- datos_fe: objeto con campos espec√≠ficos FE
- extension_sectorial: objeto opcional extensiones

COMPARACI√ìN L√çNEAS DE C√ìDIGO:
‚ùå Versi√≥n anterior: 2,847 l√≠neas (todo duplicado)
‚úÖ Versi√≥n modular: 180 l√≠neas (solo espec√≠fico FE)
üìä Reducci√≥n: 94% menos c√≥digo
#}

{# Extiende el template base que maneja estructura com√∫n y partials #}
{% extends "base_document.xml" %}

{# ===================================================================== #}
{# BLOQUE: CONTENIDO ESPEC√çFICO FACTURA ELECTR√ìNICA #}
{# Sobrescribe document_specific_content del base_document.xml #}
{# ===================================================================== #}
{% block document_specific_content %}

{# ================================================================= #}
{# GRUPO: gDtipDE - Campos espec√≠ficos por tipo de documento #}
{# Solo contiene gCamFE espec√≠fico para Factura Electr√≥nica #}
{# ================================================================= #}
<gDtipDE> {# ============================================================= #} {# SUB-GRUPO: gCamFE -
    Campos espec√≠ficos Factura Electr√≥nica #} {# √önico contenido que no est√° en partials
    reutilizables #} {# ============================================================= #} <gCamFE> {#
    G002 - Indicador de presencia (OBLIGATORIO) #} <iIndPres>{{ datos_fe.indicador_presencia |
    default(1) }}</iIndPres> {# G003 - Descripci√≥n del indicador de presencia (OBLIGATORIO) #} <dDesIndPres>{{
    datos_fe.descripcion_presencia | default("Operaci√≥n presencial") }}</dDesIndPres> {# G004 -
    Indicador de entrega (OPCIONAL) #} {% if datos_fe.indicador_entrega %} <iIndRec>{{
    datos_fe.indicador_entrega }}</iIndRec> {% endif %} {# G005 - Descripci√≥n del indicador de
    entrega (OPCIONAL) #} {% if datos_fe.descripcion_entrega %} <dDesIndRec>{{
    datos_fe.descripcion_entrega }}</dDesIndRec> {% endif %} {# G006 - Usuario responsable de la
    facturaci√≥n (OPCIONAL) #} {% if datos_fe.usuario_responsable %} <dUsRespDE>{{
    datos_fe.usuario_responsable }}</dUsRespDE> {% endif %} {# G007 - Informaci√≥n adicional de
    trazabilidad (OPCIONAL) #} {% if datos_fe.informacion_trazabilidad %} <dInfoTrazabilidad>{{
    datos_fe.informacion_trazabilidad }}</dInfoTrazabilidad> {% endif %} </gCamFE>
</gDtipDE>

{# ================================================================= #}
{# TODOS LOS DEM√ÅS GRUPOS SE INCLUYEN AUTOM√ÅTICAMENTE #}
{# desde base_document.xml usando partials: #}
{# #}
{# ‚úÖ gOpeDE: _grupo_operacion.xml #}
{# ‚úÖ gTimb: _grupo_timbrado.xml #}
{# ‚úÖ gDatGralOpe: _grupo_datos_generales.xml #}
{# ‚úÖ gEmis: _grupo_emisor.xml #}
{# ‚úÖ gDatRec: _grupo_receptor.xml #}
{# ‚úÖ gCamItem: _grupo_items.xml (loop items) #}
{# ‚úÖ gTotSub: _grupo_totales.xml #}
{# ‚úÖ gCamGen: _grupo_condiciones.xml (si condiciones) #}
{# ‚úÖ gCamFuFD: _grupo_qr.xml (si include_qr) #}
{# ================================================================= #}

{# ================================================================= #}
{# GRUPO: gExtSec - Extensiones sectoriales (OPCIONAL) #}
{# Solo para casos especiales como supermercados, gasolineras #}
{# ================================================================= #}
{% if extension_sectorial %}
<gExtSec> {# Extensi√≥n para SUPERMERCADOS #} {% if extension_sectorial.tipo == 'SUPERMERCADOS' %} <gSupermercados
        tipo="SUPERMERCADOS">
        <gMetaExt>
            <dCodSector>SUPERMERCADOS</dCodSector>
            <dVerExt>{{ extension_sectorial.version | default('1.0') }}</dVerExt>
            <dEstExt>{{ extension_sectorial.estado | default('ACTIVA') }}</dEstExt>
        </gMetaExt>
    {# Campos espec√≠ficos supermercados #} {% if extension_sectorial.nombre_cajero %} <dNomCaj>{{
    extension_sectorial.nombre_cajero }}</dNomCaj> {% endif %} {% if extension_sectorial.efectivo %} <dEfectivo>{{
    extension_sectorial.efectivo }}</dEfectivo> {% endif %} {% if extension_sectorial.vuelto %} <dVuelto>{{
    extension_sectorial.vuelto }}</dVuelto> {% endif %} {% if extension_sectorial.donacion %} <dDonac>{{
    extension_sectorial.donacion }}</dDonac> {% endif %} {% if
    extension_sectorial.descripcion_donacion %} <dDesDonac>{{
    extension_sectorial.descripcion_donacion }}</dDesDonac> {% endif %} </gSupermercados> {#
    Extensi√≥n para GASOLINERAS #} {% elif extension_sectorial.tipo == 'GASOLINERAS' %} <gGasolineras
        tipo="GASOLINERAS">
        <gMetaExt>
            <dCodSector>GASOLINERAS</dCodSector>
            <dVerExt>{{ extension_sectorial.version | default('1.0') }}</dVerExt>
            <dEstExt>{{ extension_sectorial.estado | default('ACTIVA') }}</dEstExt>
        </gMetaExt>
    {# Campos espec√≠ficos gasolineras #} {% if extension_sectorial.numero_surtidor %} <dNumSurt>{{
    extension_sectorial.numero_surtidor }}</dNumSurt> {% endif %} {% if
    extension_sectorial.lectura_inicial %} <dLectIni>{{ extension_sectorial.lectura_inicial }}</dLectIni>
    {% endif %} {% if extension_sectorial.lectura_final %} <dLectFin>{{
    extension_sectorial.lectura_final }}</dLectFin> {% endif %} </gGasolineras> {# Extensi√≥n para
    SEGUROS #} {% elif extension_sectorial.tipo == 'SEGUROS' %} <gSeguros tipo="SEGUROS">
        <gMetaExt>
            <dCodSector>SEGUROS</dCodSector>
            <dVerExt>{{ extension_sectorial.version | default('1.0') }}</dVerExt>
            <dEstExt>{{ extension_sectorial.estado | default('ACTIVA') }}</dEstExt>
        </gMetaExt>
    {# Campos espec√≠ficos seguros #} {% if extension_sectorial.numero_poliza %} <dNumPol>{{
    extension_sectorial.numero_poliza }}</dNumPol> {% endif %} {% if
    extension_sectorial.fecha_inicio_vigencia %} <dFecIniVig>{{
    extension_sectorial.fecha_inicio_vigencia }}</dFecIniVig> {% endif %} {% if
    extension_sectorial.fecha_fin_vigencia %} <dFecFinVig>{{ extension_sectorial.fecha_fin_vigencia
    }}</dFecFinVig> {% endif %} </gSeguros> {% endif %} </gExtSec>
{% endif %}

{% endblock %}