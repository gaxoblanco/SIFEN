{# ===================================================================== #}
{# TEMPLATE: NOTA DE D√âBITO ELECTR√ìNICA MODULAR (iTipDE = 6) #}
{# ===================================================================== #}
{#
PROP√ìSITO: Template Jinja2 modular para Nota de D√©bito Electr√≥nica usando partials
TIPO SIFEN: iTipDE = 6 (Nota de d√©bito electr√≥nica)
BASE: Extiende base_document.xml (usa partials autom√°ticamente)
VALIDACI√ìN: Compatible con DE_v150.xsd

NUEVA ARQUITECTURA MODULAR:
‚úÖ base_document.xml maneja toda la estructura com√∫n
‚úÖ Partials se incluyen autom√°ticamente desde base
‚úÖ Este template solo maneja campos espec√≠ficos de NDE
‚úÖ Reducci√≥n de c√≥digo: ~2,000+ ‚Üí 130 l√≠neas (94% menos)

CARACTER√çSTICAS CR√çTICAS NDE:
‚ö†Ô∏è Referencia obligatoria a documento original
‚ö†Ô∏è Motivo de d√©bito espec√≠fico y obligatorio
‚ö†Ô∏è Montos t√≠picamente positivos (aumentan deuda del cliente)
‚ö†Ô∏è Validaciones de consistencia con documento original

CASOS DE USO NDE:
üéØ Intereses por pago tard√≠o
üéØ Gastos adicionales post-venta
üéØ Cargos no incluidos en factura original
üéØ Multas o penalizaciones
üéØ Ajustes que aumentan el monto a pagar

PARTIALS INCLUIDOS AUTOM√ÅTICAMENTE:
‚úÖ _grupo_operacion.xml (gOpeDE) - tipo_documento = "6"
‚úÖ _grupo_timbrado.xml (gTimb)
‚úÖ _grupo_datos_generales.xml (gDatGralOpe)
‚úÖ _grupo_emisor.xml (gEmis)
‚úÖ _grupo_receptor.xml (gDatRec)
‚úÖ _grupo_items.xml (gCamItem - loop autom√°tico)
‚úÖ _grupo_totales.xml (gTotSub)
‚úÖ _grupo_condiciones.xml (gCamGen - condicional)
‚úÖ _documento_asociado.xml (gDocAso - OBLIGATORIO para NDE)

SOLO CAMPOS ESPEC√çFICOS NDE:
üéØ gDtipDE > gCamNDE (motivo d√©bito espec√≠fico)
üéØ gDocAso (documento asociado OBLIGATORIO)

VARIABLES REQUERIDAS:
- cdc: CDC de 44 caracteres
- tipo_documento: "6" (autom√°tico)
- datos_nde: objeto con motivo d√©bito espec√≠fico
- documento_asociado: objeto OBLIGATORIO con referencia documento original

COMPARACI√ìN L√çNEAS DE C√ìDIGO:
‚ùå Versi√≥n tradicional: ~2,000+ l√≠neas (todo duplicado)
‚úÖ Versi√≥n modular: 130 l√≠neas (solo espec√≠fico NDE)
üìä Reducci√≥n: 94% menos c√≥digo
#}

{# Extiende el template base que maneja estructura com√∫n y partials #}
{% extends "base_document.xml" %}

{# ===================================================================== #}
{# BLOQUE: CONTENIDO ESPEC√çFICO NOTA DE D√âBITO ELECTR√ìNICA #}
{# Sobrescribe document_specific_content del base_document.xml #}
{# ===================================================================== #}
{% block document_specific_content %}

{# ================================================================= #}
{# GRUPO: gDocAso - Documento asociado (OBLIGATORIO en NDE) #}
{# Referencia al documento original al que se agregan cargos #}
{# ================================================================= #}
{% include 'partials/_documento_asociado.xml' %}

{# ================================================================= #}
{# GRUPO: gDtipDE - Campos espec√≠ficos por tipo de documento #}
{# Solo contiene gCamNDE espec√≠fico para Nota de D√©bito #}
{# ================================================================= #}
<gDtipDE> {# ============================================================= #} {# SUB-GRUPO: gCamNDE
    - Campos espec√≠ficos Nota de D√©bito #} {# OBLIGATORIO para iTipDE = 6 #} {# √önico contenido que
    no est√° en partials reutilizables #} {#
    ============================================================= #} <gCamNDE> {# E500 - Motivo de
    emisi√≥n de la nota de d√©bito (OBLIGATORIO) #} {# 1=Intereses, 2=Gastos, 3=Multas, 4=Ajustes,
    5=Servicios adicionales, 6=Otros #} <iMotEmi>{{ datos_nde.motivo_emision }}</iMotEmi> {# E501 -
    Descripci√≥n del motivo de emisi√≥n (OBLIGATORIO) #} <dDesMotEmi>{{ datos_nde.descripcion_motivo
    }}</dDesMotEmi> {# E502 - Observaciones del motivo (OPCIONAL) #} {% if
    datos_nde.observaciones_motivo %} <dObsNDE>{{ datos_nde.observaciones_motivo }}</dObsNDE> {%
    endif %} {# E503 - Usuario responsable de la emisi√≥n (OPCIONAL) #} {% if
    datos_nde.usuario_responsable %} <dUsResp>{{ datos_nde.usuario_responsable }}</dUsResp> {% endif
    %} {# E504 - Informaci√≥n adicional de trazabilidad (OPCIONAL) #} {% if
    datos_nde.informacion_trazabilidad %} <dInfoTraz>{{ datos_nde.informacion_trazabilidad }}</dInfoTraz>
    {% endif %} {# E505 - Fecha de vencimiento del cargo (OPCIONAL) #} {% if
    datos_nde.fecha_vencimiento_cargo %} <dFecVencCargo>{{ datos_nde.fecha_vencimiento_cargo }}</dFecVencCargo>
    {% endif %} {# E506 - Tipo de cargo (OPCIONAL) #} {% if datos_nde.tipo_cargo %} <iTipCargo>{{
    datos_nde.tipo_cargo }}</iTipCargo> {% endif %} {# E507 - Descripci√≥n del tipo de cargo
    (OPCIONAL) #} {% if datos_nde.descripcion_tipo_cargo %} <dDesTipCargo>{{
    datos_nde.descripcion_tipo_cargo }}</dDesTipCargo> {% endif %} </gCamNDE>
</gDtipDE>

{# ================================================================= #}
{# TODOS LOS DEM√ÅS GRUPOS SE INCLUYEN AUTOM√ÅTICAMENTE #}
{# desde base_document.xml usando partials: #}
{# #}
{# ‚úÖ gOpeDE: _grupo_operacion.xml (tipo_documento = "6") #}
{# ‚úÖ gTimb: _grupo_timbrado.xml #}
{# ‚úÖ gDatGralOpe: _grupo_datos_generales.xml #}
{# ‚úÖ gEmis: _grupo_emisor.xml #}
{# ‚úÖ gDatRec: _grupo_receptor.xml #}
{# ‚úÖ gCamItem: _grupo_items.xml (loop items - montos positivos) #}
{# ‚úÖ gTotSub: _grupo_totales.xml (totales positivos t√≠picos) #}
{# ‚úÖ gCamGen: _grupo_condiciones.xml (si condiciones) #}
{# ‚úÖ gCamFuFD: _grupo_qr.xml (si include_qr) #}
{# #}
{# NOTAS ESPEC√çFICAS NDE: #}
{# - Items t√≠picamente con cantidades/montos positivos #}
{# - Totales aumentan la deuda del cliente #}
{# - Emisor/receptor deben coincidir con documento original #}
{# ================================================================= #}

{% endblock %}