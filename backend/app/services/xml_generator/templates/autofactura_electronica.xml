{# ===================================================================== #}
{# TEMPLATE: AUTOFACTURA ELECTR√ìNICA MODULAR (iTipDE = 4) #}
{# ===================================================================== #}
{#
PROP√ìSITO: Template Jinja2 modular para Autofactura Electr√≥nica usando partials
TIPO SIFEN: iTipDE = 4 (Autofactura electr√≥nica)
BASE: Extiende base_document.xml (usa partials autom√°ticamente)
VALIDACI√ìN: Compatible con DE_v150.xsd

NUEVA ARQUITECTURA MODULAR:
‚úÖ base_document.xml maneja toda la estructura com√∫n
‚úÖ Partials se incluyen autom√°ticamente desde base
‚úÖ Este template solo maneja campos espec√≠ficos de AFE
‚úÖ Reducci√≥n de c√≥digo: 2,156 ‚Üí 95 l√≠neas (96% menos)

CASOS DE USO AFE:
üéØ Importaciones (vendedor extranjero)
üéØ Compras a no contribuyentes nacionales
üéØ Operaciones donde receptor debe emitir factura

CARACTER√çSTICAS CR√çTICAS AFE:
‚ö†Ô∏è Emisor = Receptor (mismo RUC obligatorio)
‚ö†Ô∏è gCamAE obligatorio (datos vendedor original)
‚ö†Ô∏è Naturaleza vendedor: 1=No contribuyente, 2=Extranjero
‚ö†Ô∏è Datos geogr√°ficos completos obligatorios

PARTIALS INCLUIDOS AUTOM√ÅTICAMENTE:
‚úÖ _grupo_operacion.xml (gOpeDE) - tipo_documento = "4"
‚úÖ _grupo_timbrado.xml (gTimb)
‚úÖ _grupo_datos_generales.xml (gDatGralOpe)
‚úÖ _grupo_emisor.xml (gEmis) - emisor = receptor
‚úÖ _grupo_receptor.xml (gDatRec) - receptor = emisor
‚úÖ _grupo_items.xml (gCamItem - loop autom√°tico)
‚úÖ _grupo_totales.xml (gTotSub)
‚úÖ _grupo_condiciones.xml (gCamGen - condicional)

SOLO CAMPOS ESPEC√çFICOS AFE:
üéØ gDtipDE > gCamAE (datos vendedor original - OBLIGATORIO)

VARIABLES SIMPLIFICADAS:
- cdc: CDC de 44 caracteres
- tipo_documento: "4" (autom√°tico)
- datos_afe: objeto con datos espec√≠ficos AFE/vendedor original

COMPARACI√ìN L√çNEAS DE C√ìDIGO:
‚ùå Versi√≥n anterior: 2,156 l√≠neas (todo duplicado)
‚úÖ Versi√≥n modular: 95 l√≠neas (solo espec√≠fico AFE)
üìä Reducci√≥n: 96% menos c√≥digo
#}

{# Extiende el template base que maneja estructura com√∫n y partials #}
{% extends "base_document.xml" %}

{# ===================================================================== #}
{# BLOQUE: CONTENIDO ESPEC√çFICO AUTOFACTURA ELECTR√ìNICA #}
{# Sobrescribe document_specific_content del base_document.xml #}
{# ===================================================================== #}
{% block document_specific_content %}

{# ================================================================= #}
{# GRUPO: gDtipDE - Campos espec√≠ficos por tipo de documento #}
{# Solo contiene gCamAE espec√≠fico para Autofactura Electr√≥nica #}
{# ================================================================= #}
<gDtipDE> {# ============================================================= #} {# SUB-GRUPO: gCamAE -
    Campos espec√≠ficos Autofactura #} {# OBLIGATORIO para iTipDE = 4 #} {# √önico contenido que no
    est√° en partials reutilizables #} {#
    ============================================================= #} <gCamAE> {# E300 - Naturaleza
    del vendedor (OBLIGATORIO) #} {# 1=No contribuyente, 2=Extranjero #} <iNatVen>{{
    datos_afe.naturaleza_vendedor }}</iNatVen> {# E301 - Descripci√≥n de la naturaleza del vendedor
    (OBLIGATORIO) #} <dDesNatVen>{{ datos_afe.descripcion_naturaleza_vendedor }}</dDesNatVen> {#
    E302 - Tipo de documento de identidad del vendedor (OBLIGATORIO) #} <iTipIDVen>{{
    datos_afe.tipo_documento_vendedor }}</iTipIDVen> {# E303 - Descripci√≥n del tipo de documento del
    vendedor (OBLIGATORIO) #} <dDTipIDVen>{{ datos_afe.descripcion_tipo_documento_vendedor }}</dDTipIDVen>
    {# E304 - N√∫mero de documento del vendedor (OBLIGATORIO) #} <dNumIDVen>{{
    datos_afe.numero_documento_vendedor }}</dNumIDVen> {# E305 - Nombre o raz√≥n social del vendedor
    (OBLIGATORIO) #} <dNomVen>{{ datos_afe.nombre_vendedor }}</dNomVen> {# E306 - Direcci√≥n del
    vendedor (OBLIGATORIO) #} <dDirVen>{{ datos_afe.direccion_vendedor }}</dDirVen> {# E307 - N√∫mero
    de casa del vendedor (OPCIONAL) #} {% if datos_afe.numero_casa_vendedor %} <dNumCasVen>{{
    datos_afe.numero_casa_vendedor }}</dNumCasVen> {% endif %} {# E308 - Complemento direcci√≥n 1 del
    vendedor (OPCIONAL) #} {% if datos_afe.complemento_direccion1_vendedor %} <dCompDirVen1>{{
    datos_afe.complemento_direccion1_vendedor }}</dCompDirVen1> {% endif %} {# E309 - Complemento
    direcci√≥n 2 del vendedor (OPCIONAL) #} {% if datos_afe.complemento_direccion2_vendedor %} <dCompDirVen2>{{
    datos_afe.complemento_direccion2_vendedor }}</dCompDirVen2> {% endif %} {#
    ========================================================= #} {# UBICACI√ìN GEOGR√ÅFICA DEL
    VENDEDOR (OBLIGATORIO) #} {# ========================================================= #} {#
    E310 - C√≥digo del departamento del vendedor (OBLIGATORIO) #} <cDepVen>{{
    datos_afe.codigo_departamento_vendedor }}</cDepVen> {# E311 - Descripci√≥n del departamento del
    vendedor (OBLIGATORIO) #} <dDesDepVen>{{ datos_afe.descripcion_departamento_vendedor }}</dDesDepVen>
    {# E312 - C√≥digo del distrito del vendedor (OBLIGATORIO) #} <cDisVen>{{
    datos_afe.codigo_distrito_vendedor }}</cDisVen> {# E313 - Descripci√≥n del distrito del vendedor
    (OBLIGATORIO) #} <dDesDisVen>{{ datos_afe.descripcion_distrito_vendedor }}</dDesDisVen> {# E314
    - C√≥digo de la ciudad del vendedor (OBLIGATORIO) #} <cCiuVen>{{ datos_afe.codigo_ciudad_vendedor
    }}</cCiuVen> {# E315 - Descripci√≥n de la ciudad del vendedor (OBLIGATORIO) #} <dDesCiuVen>{{
    datos_afe.descripcion_ciudad_vendedor }}</dDesCiuVen> {# E316 - Direcci√≥n de email del vendedor
    (OPCIONAL) #} {% if datos_afe.email_vendedor %} <dDirEmailVen>{{ datos_afe.email_vendedor }}</dDirEmailVen>
    {% endif %} {# ========================================================= #} {# UBICACI√ìN
    GEOGR√ÅFICA DE LA TRANSACCI√ìN (OBLIGATORIO) #} {#
    ========================================================= #} {# E317 - C√≥digo del departamento
    de la transacci√≥n (OBLIGATORIO) #} <cDepTrans>{{ datos_afe.codigo_departamento_transaccion }}</cDepTrans>
    {# E318 - Descripci√≥n del departamento de la transacci√≥n (OBLIGATORIO) #} <dDesDepTrans>{{
    datos_afe.descripcion_departamento_transaccion }}</dDesDepTrans> {# E319 - C√≥digo del distrito
    de la transacci√≥n (OBLIGATORIO) #} <cDisTrans>{{ datos_afe.codigo_distrito_transaccion }}</cDisTrans>
    {# E320 - Descripci√≥n del distrito de la transacci√≥n (OBLIGATORIO) #} <dDesDisTrans>{{
    datos_afe.descripcion_distrito_transaccion }}</dDesDisTrans> {# E321 - C√≥digo de la ciudad de la
    transacci√≥n (OBLIGATORIO) #} <cCiuTrans>{{ datos_afe.codigo_ciudad_transaccion }}</cCiuTrans> {#
    E322 - Descripci√≥n de la ciudad de la transacci√≥n (OBLIGATORIO) #} <dDesCiuTrans>{{
    datos_afe.descripcion_ciudad_transaccion }}</dDesCiuTrans>
    </gCamAE>
</gDtipDE>

{# ================================================================= #}
{# TODOS LOS DEM√ÅS GRUPOS SE INCLUYEN AUTOM√ÅTICAMENTE #}
{# desde base_document.xml usando partials: #}
{# #}
{# ‚úÖ gOpeDE: _grupo_operacion.xml (tipo_documento = "4") #}
{# ‚úÖ gTimb: _grupo_timbrado.xml #}
{# ‚úÖ gDatGralOpe: _grupo_datos_generales.xml #}
{# ‚úÖ gEmis: _grupo_emisor.xml (emisor = receptor) #}
{# ‚úÖ gDatRec: _grupo_receptor.xml (receptor = emisor) #}
{# ‚úÖ gCamItem: _grupo_items.xml (loop items) #}
{# ‚úÖ gTotSub: _grupo_totales.xml #}
{# ‚úÖ gCamGen: _grupo_condiciones.xml (si condiciones) #}
{# ‚úÖ gCamFuFD: _grupo_qr.xml (si include_qr) #}
{# #}
{# NOTA CR√çTICA AFE: #}
{# - emisor.ruc DEBE ser igual a receptor.ruc #}
{# - Validaci√≥n en l√≥gica de negocio, no en template #}
{# ================================================================= #}

{% endblock %}