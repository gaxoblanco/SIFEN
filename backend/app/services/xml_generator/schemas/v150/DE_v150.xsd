<?xml version="1.0" encoding="UTF-8"?>
<!-- 
  Schema Principal SIFEN v150 - Documento Electr√≥nico MODULAR
  Archivo: DE_v150.xsd
  
  Este schema IMPORTA los m√≥dulos reales de common/ y document_core/
  y define solo la estructura de orquestaci√≥n.
  
  M√≥dulos importados:
  - common/basic_types.xsd (tipos b√°sicos)
  - common/currency_types.xsd (tipos monetarios) 
  - document_core/totals_subtotals.xsd (totales corregido)
  
  Autor: Sistema SIFEN Paraguay
  Versi√≥n: 1.5.0 Modular
  Fecha: 2025-06-21
-->

<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           xmlns="http://ekuatia.set.gov.py/sifen/xsd"
           targetNamespace="http://ekuatia.set.gov.py/sifen/xsd"
           elementFormDefault="qualified"
           attributeFormDefault="unqualified"
           version="1.5.0">

    <!-- ===================================================================== -->
    <!-- IMPORTACI√ìN DE M√ìDULOS EXISTENTES                                    -->
    <!-- ===================================================================== -->
    
    <!-- M√≥dulos common/ existentes -->
    <xs:include schemaLocation="common/basic_types.xsd"/>
    <xs:include schemaLocation="common/currency_types.xsd"/>
    
    <!-- M√≥dulos document_core/ existentes -->
    <xs:include schemaLocation="document_core/totals_subtotals.xsd"/>

    <!-- ===================================================================== -->
    <!-- TIPOS ADICIONALES NECESARIOS (solo los que NO est√°n en m√≥dulos)     -->
    <!-- ===================================================================== -->
    
    <!-- Grupo de operaci√≥n del documento (eventual ‚Üí document_core/operation_data.xsd) -->
    <xs:complexType name="tipoGrupoOperacionDocumento">
        <xs:annotation>
            <xs:documentation>
                gOpeDE - Datos b√°sicos de la operaci√≥n del documento
                
                TODO: Mover a document_core/operation_data.xsd cuando se implemente
            </xs:documentation>
        </xs:annotation>
        <xs:sequence>
            <xs:element name="iTiDE" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Tipo de documento electr√≥nico</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dDesTiDE" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Descripci√≥n del tipo de documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dNumTimbr" type="xs:string">
                <xs:annotation>
                    <xs:documentation>N√∫mero de timbrado</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dEst" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Establecimiento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dPunExp" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Punto de expedici√≥n</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dNumDoc" type="xs:string">
                <xs:annotation>
                    <xs:documentation>N√∫mero del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dSerie" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Serie del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dFeEmiDE" type="xs:dateTime">
                <xs:annotation>
                    <xs:documentation>Fecha de emisi√≥n del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
    
    <!-- Grupo de timbrado (eventual ‚Üí document_core/stamping_data.xsd) -->
    <xs:complexType name="tipoGrupoTimbrado">
        <xs:annotation>
            <xs:documentation>
                gTimb - Datos del timbrado fiscal
                
                TODO: Mover a document_core/stamping_data.xsd cuando se implemente
            </xs:documentation>
        </xs:annotation>
        <xs:sequence>
            <xs:element name="iTiDE" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Tipo de documento electr√≥nico</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dDesTiDE" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Descripci√≥n del tipo de documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dNumTimbr" type="xs:string">
                <xs:annotation>
                    <xs:documentation>N√∫mero de timbrado</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dEst" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Establecimiento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dPunExp" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Punto de expedici√≥n</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dNumDoc" type="xs:string">
                <xs:annotation>
                    <xs:documentation>N√∫mero del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dSerie" type="xs:string">
                <xs:annotation>
                    <xs:documentation>Serie del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dFeIniT" type="xs:date">
                <xs:annotation>
                    <xs:documentation>Fecha de inicio de vigencia del timbrado</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="dFeFinT" type="xs:date">
                <xs:annotation>
                    <xs:documentation>Fecha de fin de vigencia del timbrado</xs:documentation>
                </xs:annotation>
            </xs:element>
        </xs:sequence>
    </xs:complexType>

    <!-- ===================================================================== -->
    <!-- DOCUMENTO ELECTR√ìNICO PRINCIPAL                                      -->
    <!-- ===================================================================== -->
    
    <!-- Tipo del documento electr√≥nico completo -->
    <xs:complexType name="tipoDocumentoElectronico">
        <xs:annotation>
            <xs:documentation>DE - Documento electr√≥nico completo</xs:documentation>
        </xs:annotation>
        <xs:sequence>
            <!-- Grupos actuales -->
            <xs:element name="gOpeDE" type="tipoGrupoOperacionDocumento" minOccurs="0">
                <xs:annotation>
                    <xs:documentation>Grupo de operaci√≥n del documento</xs:documentation>
                </xs:annotation>
            </xs:element>
            <xs:element name="gTimb" type="tipoGrupoTimbrado" minOccurs="0">
                <xs:annotation>
                    <xs:documentation>Grupo de timbrado</xs:documentation>
                </xs:annotation>
            </xs:element>
            
            <!-- üéØ USAR TIPO DEL M√ìDULO IMPORTADO -->
            <xs:element name="gTotSub" type="tipoGrupoTotalesSubtotales" minOccurs="0">
                <xs:annotation>
                    <xs:documentation>
                        Grupo de totales y subtotales - IMPORTADO desde document_core/totals_subtotals.xsd
                    </xs:documentation>
                </xs:annotation>
            </xs:element>
            
            <!-- 
            FUTUROS GRUPOS (cuando se implementen los m√≥dulos):
            
            <xs:element name="gDatRec" type="tipoGrupoReceptor" minOccurs="0"/>        
            <xs:element name="gEmisor" type="tipoGrupoEmisor" minOccurs="0"/>          
            <xs:element name="gItems" type="tipoGrupoItems" minOccurs="0"/>           
            <xs:element name="gCondPago" type="tipoGrupoCondicionesPago" minOccurs="0"/>  
            <xs:element name="gTransp" type="tipoGrupoTransporte" minOccurs="0"/>     
            <xs:element name="gCamEsp" type="tipoGrupoCamposEspecificos" minOccurs="0"/> 
            -->
        </xs:sequence>
        
        <!-- Atributo CDC (C√≥digo de Control del Documento) -->
        <xs:attribute name="Id" type="xs:string" use="required">
            <xs:annotation>
                <xs:documentation>CDC - C√≥digo de Control del Documento (44 d√≠gitos)</xs:documentation>
            </xs:annotation>
        </xs:attribute>
    </xs:complexType>

    <!-- ===================================================================== -->
    <!-- ELEMENTOS GLOBALES PARA VALIDACI√ìN INDEPENDIENTE                    -->
    <!-- ===================================================================== -->
    
    <xs:element name="gOpeDE" type="tipoGrupoOperacionDocumento">
        <xs:annotation>
            <xs:documentation>Elemento global para validar grupo de operaci√≥n independientemente</xs:documentation>
        </xs:annotation>
    </xs:element>
    
    <xs:element name="gTimb" type="tipoGrupoTimbrado">
        <xs:annotation>
            <xs:documentation>Elemento global para validar grupo de timbrado independientemente</xs:documentation>
        </xs:annotation>
    </xs:element>
    
    <!-- üéØ ELEMENTO GLOBAL DEL M√ìDULO IMPORTADO -->
    <!-- 
    Este elemento YA est√° definido en document_core/totals_subtotals.xsd
    No lo redefinimos aqu√≠ - lo usamos del m√≥dulo importado
    -->

    <!-- ===================================================================== -->
    <!-- ELEMENTO RA√çZ                                                        -->
    <!-- ===================================================================== -->
    
    <xs:element name="rDE">
        <xs:annotation>
            <xs:documentation>
                Elemento ra√≠z del Documento Electr√≥nico SIFEN v150.
                
                Usa tipos de m√≥dulos importados donde est√°n disponibles.
            </xs:documentation>
        </xs:annotation>
        <xs:complexType>
            <xs:sequence>
                <!-- üéØ USAR TIPO DEL M√ìDULO basic_types.xsd (si existe) -->
                <xs:element name="dVerFor" type="xs:string">
                    <xs:annotation>
                        <xs:documentation>
                            Versi√≥n del formato del documento.
                            TODO: Cambiar a tipoVersionFormato cuando est√© en basic_types.xsd
                        </xs:documentation>
                    </xs:annotation>
                </xs:element>
                <xs:element name="DE" type="tipoDocumentoElectronico">
                    <xs:annotation>
                        <xs:documentation>Documento Electr√≥nico completo</xs:documentation>
                    </xs:annotation>
                </xs:element>
            </xs:sequence>
            
            <xs:attribute name="version" type="xs:string" fixed="1.5.0" use="required">
                <xs:annotation>
                    <xs:documentation>Versi√≥n del schema XSD</xs:documentation>
                </xs:annotation>
            </xs:attribute>
        </xs:complexType>
    </xs:element>

    <!-- ===================================================================== -->
    <!-- PLAN DE MODULARIZACI√ìN PROGRESIVA                                   -->
    <!-- ===================================================================== -->
    
    <!--
        ESTADO ACTUAL:
        ‚úÖ Importa: common/basic_types.xsd, common/currency_types.xsd
        ‚úÖ Importa: document_core/totals_subtotals.xsd (corregido)
        ‚è≥ Define temporalmente: tipoGrupoOperacionDocumento, tipoGrupoTimbrado
        
        PR√ìXIMOS PASOS:
        
        1. Crear document_core/operation_data.xsd
           - Mover tipoGrupoOperacionDocumento ‚Üí ah√≠
           - Importar en DE_v150.xsd
        
        2. Crear document_core/stamping_data.xsd
           - Mover tipoGrupoTimbrado ‚Üí ah√≠
           - Importar en DE_v150.xsd
        
        3. Mejorar common/basic_types.xsd
           - Agregar tipoVersionFormato
           - Agregar tipoTipoDocumento con enumeraciones
           - Agregar tipoRUC, tipoCDC, etc.
        
        4. Crear parties/issuer_types.xsd, parties/receiver_types.xsd
        
        5. Crear operations/items.xsd, operations/payment_types.xsd
        
        6. Crear document_types/ para campos espec√≠ficos por tipo
        
        BENEFICIOS DE ESTE ENFOQUE:
        - ‚úÖ Usa m√≥dulos reales existentes
        - ‚úÖ Estructura preparada para crecer
        - ‚úÖ Permite testear cada m√≥dulo independientemente
        - ‚úÖ Migraci√≥n gradual sin romper funcionalidad
    -->

</xs:schema>